<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">

    <title>Assitencia</title>
  </head>
  <body>

    <div class="container-sm">

      <div class="mb-3">
        <label for="exampleInputEmail1" class="form-label">Carnet</label>
        <input type="text" class="form-control" id="carnet" aria-describedby="emailHelp">
      </div>
     
      <div class="mb-3">
        <label for="exampleInputEmail1" class="form-label">Nombre</label>
        <input type="text" class="form-control" id="nombre" aria-describedby="emailHelp">
      </div>

      <div class="mb-3">
        <label for="exampleInputEmail1" class="form-label">Nombre del evento</label>
        <input type="text" class="form-control" id="nEvento" aria-describedby="emailHelp">
      </div>

      <div class="mb-3">
        <label for="exampleInputEmail1" class="form-label">Id del Evento</label>
        <input type="text" class="form-control" id="idEvento" aria-describedby="emailHelp">
      </div>
     
      <p><input type="file"  accept="image/*" name="image" id="file"  onchange="loadFile(event)" style="display: none;"></p>
      <p><label for="file" style="cursor: pointer;">Upload Image</label></p>
      <p><img id="output" width="200" /></p>

      <script>

      const toBase64 = file => new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.readAsDataURL(file);
          reader.onload = () => resolve(reader.result);
          reader.onerror = error => reject(error);
      });


      var loadFile = async function(event) {

        var image = document.getElementById('output')
        image.src = URL.createObjectURL(event.target.files[0])
      
        

      };
      </script>

      <button onclick="addAssistence()" class="btn btn-primary">Submit</button>
      
      <br>
      <br>
      <br>
      <br>

      <div class="mb-3">
        <label for="exampleInputEmail1" class="form-label">Carnet</label>
        <input type="text" class="form-control" id="carnetValue" aria-describedby="emailHelp">
      </div>
      <button onclick="listUser()" class="btn btn-primary">Submit</button>

      <br>
      <br>
      <br>
      <br>

      <div id="userList"></div>

      <div class="mb-3">
        <label for="exampleInputEmail1" class="form-label">Id del Evento</label>
        <input type="text" class="form-control" id="idEventoValue" aria-describedby="emailHelp">
      </div>
      <button onclick="listEvent()" class="btn btn-primary">Submit</button>

      <div id="eventList"></div>

    </div>

<script>
  async function addAssistence () {
    
    // let carnet = document.getElementById('carnet')
    // let nombre = document.getElementById('nombre')
    // let nEvento = document.getElementById('nEvento')
    // let idEVento = document.getElementById('idEVento')
  
    const file = document.getElementById('file').files[0]
    var imgBase64 = await toBase64(file)
    // console.log(imgBase64);

    let obj = { 
                carnet: parseInt(document.getElementById('carnet').value, 10) || 0,
                nombre: document.getElementById('nombre').value,
                nEvento: document.getElementById('nEvento').value,
                idEvento: parseInt(document.getElementById('idEvento').value, 10) || 0,
                img: imgBase64
               
              }

  //  console.log(obj)


   fetch(`http://localhost:5000/AgregarUsuario`, {
      method: 'POST',
      body: JSON.stringify(obj),
      headers: {
        'Content-Type': 'application/json',
        'mode': 'no-cors'
      }
    }).then((res)=>{
        alert(res.body)
    })



  }

  
  async function listUser () {
 
    let obj = { carnet: parseInt(document.getElementById('carnetValue').value, 10) || 0  }
// console.log(obj)
    fetch(`http://localhost:5000/ListarPorCarnet`, {
      method: 'POST',
      body: JSON.stringify(obj),
      headers: {
        'Content-Type': 'application/json',
        'mode': 'no-cors'
      }
    })
    .then(async function (response) {
      let jsonObj = await response.json();
      console.log(jsonObj)

      let tabla = jsonObj.map((data)=>{
          return `<tr><td>${data.nombreEvento}</td><td>${data.idEvento}</td><td><img width="200" src="${data.imagen}" ></td></tr>`
      }).join(",")

      console.log(tabla)

      let fullT = `<table class="table">
  <thead>
    <tr>
      <th scope="col">Nombre Evento</th>
      <th scope="col">ID Evento</th>
      <th scope="col">Imagen</th>
    </tr>
  </thead>
  <tbody>
   ${tabla}
  </tbody>
</table`


  document.getElementById('userList').innerHTML = fullT

    })
  
  }


  async function listEvent () {

    let obj = { idEvento: parseInt(document.getElementById('idEventoValue').value, 10) || 0  }

    fetch(`http://localhost:5000/ListarIdEvento`, {
      method: 'POST',
      body: JSON.stringify(obj),
      headers: {
        'Content-Type': 'application/json',
        'mode': 'no-cors'
      }
    })
    .then(async function (response) {
     
      
      let jsonObj = await response.json();
      console.log(jsonObj)

      let tabla = jsonObj.map((data)=>{
          return `<tr><td>${data.nombre}</td><td>${data.carnet}</td><td><img width="200" src="${data.imagen}" ></td></tr>`
      }).join(",")

      console.log(tabla)

      let fullT = `<table class="table">
  <thead>
    <tr>
      <th scope="col">Nombre</th>
      <th scope="col">Carnet</th>
      <th scope="col">Imagen</th>
    </tr>
  </thead>
  <tbody>
   ${tabla}
  </tbody>
</table`


  document.getElementById('eventList').innerHTML = fullT



    })
  
  }






</script>

   <script src="./form.js"></script>



    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>
  </body>
</html>
